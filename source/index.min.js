(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={ "height":14,
 "layers":[
        {
         "data":[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 11, 10, 10, 10, 10, 12, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0, 10, 10, 20, 10, 10, 10, 18, 12, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 10, 10, 10, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 10, 10, 10, 10, 10, 10, 11, 0, 0, 0, 0, 0, 0, 0, 0, 10, 12, 10, 10, 10, 12, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0, 17, 10, 10, 10, 18, 10, 10, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 10, 10, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
         "height":14,
         "name":"background",
         "opacity":1,
         "type":"tilelayer",
         "visible":true,
         "width":16,
         "x":0,
         "y":0
        }, 
        {
         "data":[35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 34, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 3, 3, 2, 2, 2, 3, 2, 3, 35, 35, 34, 35, 35, 34, 35, 36, 0, 0, 0, 0, 0, 0, 0, 0, 33, 35, 35, 35, 35, 35, 35, 36, 0, 0, 0, 0, 0, 0, 0, 0, 33, 35, 35, 35, 35, 35, 35, 36, 0, 25, 27, 26, 26, 27, 27, 26, 35, 35, 35, 35, 35, 34, 35, 36, 0, 0, 0, 0, 0, 1, 3, 2, 35, 35, 35, 35, 35, 35, 35, 36, 0, 0, 0, 0, 0, 0, 0, 0, 33, 35, 35, 35, 35, 35, 35, 36, 0, 0, 0, 0, 0, 0, 0, 0, 33, 35, 35, 34, 35, 35, 35, 36, 0, 0, 0, 0, 0, 0, 0, 0, 33, 35, 34, 35, 35, 35, 34, 35, 27, 27, 26, 27, 28, 0, 0, 0, 33, 35, 35, 35, 35, 35, 35, 35, 34, 35, 35, 35, 35, 27, 27, 27, 35, 35, 35, 35, 35, 35, 35, 35, 34, 35, 35, 35, 35, 35, 35, 34, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35],
         "height":14,
         "name":"collision",
         "opacity":1,
         "type":"tilelayer",
         "visible":true,
         "width":16,
         "x":0,
         "y":0
        }, 
        {
         "draworder":"topdown",
         "height":0,
         "name":"entities",
         "objects":[
                {
                 "gid":44,
                 "height":0,
                 "id":4,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"TARGET",
                 "visible":true,
                 "width":0,
                 "x":193,
                 "y":162
                }, 
                {
                 "gid":44,
                 "height":0,
                 "id":5,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"TARGET",
                 "visible":true,
                 "width":0,
                 "x":225,
                 "y":322
                }, 
                {
                 "gid":44,
                 "height":0,
                 "id":6,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"TARGET",
                 "visible":true,
                 "width":0,
                 "x":225,
                 "y":290
                }, 
                {
                 "gid":44,
                 "height":0,
                 "id":7,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"TARGET",
                 "visible":true,
                 "width":0,
                 "x":225,
                 "y":259
                }, 
                {
                 "gid":41,
                 "height":0,
                 "id":8,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"BLOCK",
                 "visible":true,
                 "width":0,
                 "x":161.5,
                 "y":226.5
                }, 
                {
                 "gid":41,
                 "height":0,
                 "id":9,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"BLOCK",
                 "visible":true,
                 "width":0,
                 "x":160,
                 "y":291
                }, 
                {
                 "gid":41,
                 "height":0,
                 "id":10,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"BLOCK",
                 "visible":true,
                 "width":0,
                 "x":160,
                 "y":258.5
                }, 
                {
                 "gid":41,
                 "height":0,
                 "id":11,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"BLOCK",
                 "visible":true,
                 "width":0,
                 "x":162,
                 "y":324
                }, 
                {
                 "gid":41,
                 "height":0,
                 "id":12,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"BLOCK",
                 "visible":true,
                 "width":0,
                 "x":259,
                 "y":163
                }, 
                {
                 "gid":55,
                 "height":0,
                 "id":13,
                 "name":"",
                 "properties":
                    {

                    },
                 "rotation":0,
                 "type":"START",
                 "visible":true,
                 "width":0,
                 "x":320,
                 "y":161
                }],
         "opacity":1,
         "type":"objectgroup",
         "visible":true,
         "width":0,
         "x":0,
         "y":0
        }],
 "nextobjectid":14,
 "orientation":"orthogonal",
 "properties":
    {

    },
 "renderorder":"right-down",
 "tileheight":32,
 "tilesets":[
        {
         "firstgid":1,
         "image":"tiles.png",
         "imageheight":160,
         "imagewidth":256,
         "margin":0,
         "name":"tiles",
         "properties":
            {

            },
         "spacing":0,
         "tileheight":32,
         "tilewidth":32,
         "transparentcolor":"#ffffff"
        }, 
        {
         "firstgid":41,
         "image":"items.png",
         "imageheight":128,
         "imagewidth":128,
         "margin":0,
         "name":"items",
         "properties":
            {

            },
         "spacing":0,
         "tileheight":32,
         "tilewidth":32,
         "transparentcolor":"#ffffff"
        }],
 "tilewidth":32,
 "version":1,
 "width":16
}
},{}],2:[function(require,module,exports){

},{}],3:[function(require,module,exports){
"use strict";
var utilities = require("../utilities/utilities");
var fire;
(function (fire) {
    fire.sprites;
    var currentPosition = new Phaser.Point(0, 0);
    var nextPosition = new Phaser.Point(0, 0);
    function init(game) {
        fire.sprites = game.add.group();
        utilities.fillSpriteGroup(fire.sprites, "TARGET", "entities", 3, game);
        console.log("Found", fire.sprites.length, "fires");
        console.log(fire.sprites);
    }
    fire.init = init;
})(fire || (fire = {}));
module.exports = fire;

},{"../utilities/utilities":11}],4:[function(require,module,exports){
"use strict";
var player = require("../player/player");
var blocks = require("../ice/ice");
var fires = require("../fires/fire");
var world = require("../world/tiles");
var constant = require("../utilities/constants");
var collision = require("../physics/resolver");
var utilities = require("../utilities/utilities");
var game;
function preloadGame() {
    return function () {
        game.load.tilemap("level", utilities.level("lvl.json"), null, Phaser.Tilemap.TILED_JSON);
        game.load.image("tiles", utilities.image("tiles.png"));
        game.load.spritesheet("player", utilities.image("player-sheet.png"), constant.TileSize.width, constant.TileSize.heigth);
        game.load.spritesheet("items", utilities.image("items-sheet.png"), 30, constant.TileSize.heigth);
    };
}
function createGame() {
    return function () {
        game.stage.backgroundColor = "#787878";
        game.scale.pageAlignHorizontally = true;
        game.scale.pageAlignVertically = true;
        game.physics.startSystem(Phaser.Physics.ARCADE);
        world.map = game.add.tilemap("level");
        world.map.addTilesetImage("tiles", "tiles");
        world.loadLayers(["background", "collision"]);
        player.init(game);
        fires.init(game);
        blocks.init(game);
    };
}
function updateGame() {
    return function () {
        player.checkInputs(game);
        player.checkStopConditions(game);
        blocks.update(game);
        collision.resolve(game);
    };
}
function renderGame() {
    return function () {
    };
}
var gameworld;
(function (gameworld) {
    function init() {
        game = new Phaser.Game(16 * constant.TileSize.width, 14 * constant.TileSize.heigth, Phaser.AUTO, "FIce", {
            preload: preloadGame(),
            create: createGame(),
            update: updateGame(),
            render: renderGame()
        });
    }
    gameworld.init = init;
})(gameworld || (gameworld = {}));
module.exports = gameworld;

},{"../fires/fire":3,"../ice/ice":5,"../physics/resolver":8,"../player/player":9,"../utilities/constants":10,"../utilities/utilities":11,"../world/tiles":12}],5:[function(require,module,exports){
"use strict";
var utilities = require("../utilities/utilities");
var gravity = require("../physics/gravity");
var currentPosition = new Phaser.Point(0, 0);
var nextPosition = new Phaser.Point(0, 0);
var ice;
(function (_ice) {
    _ice.sprites;
    function init(game) {
        _ice.sprites = game.add.group();
        utilities.fillSpriteGroup(ice.sprites, "BLOCK", "entities", 0, game);
    }
    _ice.init = init;
    function update(game) {
        _ice.sprites.children.forEach(function (ice) {
            if (gravity.checkCanSpriteStartFalling(ice)) {
                ice.body.velocity.x = 0;
            }
        });
    }
    _ice.update = update;
})(ice || (ice = {}));
module.exports = ice;

},{"../physics/gravity":7,"../utilities/utilities":11}],6:[function(require,module,exports){
"use strict";
var gameworld = require("./game/game");
gameworld.init();

},{"./game/game":4}],7:[function(require,module,exports){
"use strict";
var world = require("../world/tiles");
var utilities = require("../utilities/utilities");
var constant = require("../utilities/constants");
var gravity;
(function (gravity) {
    function checkCanSpriteStartFalling(sprite) {
        var tileX = utilities.getTileXFromWorldCoordinate(sprite.body.x);
        var tileY = utilities.getTileYFromWorldCoordinate(sprite.body.y + constant.TileSize.heigth);
        if (!world.map.hasTile(tileX, tileY, world.layers["collision"])) {
            sprite.body.velocity.y = constant.Velocity;
            console.log("Started falling", sprite.name);
            return true;
        }
        return false;
    }
    gravity.checkCanSpriteStartFalling = checkCanSpriteStartFalling;
    ;
    function checkCanGroupStartFalling(group) {
        if (group.children && group.children.length <= 0) {
            return;
        }
        group.children.forEach(function (sprite) {
            checkCanSpriteStartFalling(sprite);
        });
    }
    gravity.checkCanGroupStartFalling = checkCanGroupStartFalling;
    ;
})(gravity || (gravity = {}));
module.exports = gravity;

},{"../utilities/constants":10,"../utilities/utilities":11,"../world/tiles":12}],8:[function(require,module,exports){
"use strict";
var player = require("../player/player");
var ice = require("../ice/ice");
var fires = require("../fires/fire");
var world = require("../world/tiles");
var resolver;
(function (resolver) {
    function playerToIceCollision(player, ice) {
        console.log("Player colliding with Ice", player, ice);
        ice.body.velocity.x = player.body.velocity.x;
        player.body.velocity.x = 0;
    }
    resolver.playerToIceCollision = playerToIceCollision;
    ;
    function iceExtinguishesFire(ice, fire) {
        console.log("Ice is overlapping fire.");
        ice.kill();
        fire.kill();
    }
    resolver.iceExtinguishesFire = iceExtinguishesFire;
    ;
    function playerDiesOnFire(playerSprite, fire) {
        console.log("Player dies on fire.");
        player.death();
    }
    resolver.playerDiesOnFire = playerDiesOnFire;
    ;
    function debugCollisionHandler(obj1, obj2) {
        console.log("obj1", obj1, ", obj2", obj2);
    }
    resolver.debugCollisionHandler = debugCollisionHandler;
    ;
    function resolve(game) {
        game.physics.arcade.collide(player.sprite, ice.sprites, playerToIceCollision, null, this);
        game.physics.arcade.collide(player.sprite, world.layers["collision"]);
        game.physics.arcade.collide(ice.sprites, world.layers["collision"]);
        game.physics.arcade.overlap(player.sprite, fires.sprites, playerDiesOnFire, null, this);
        game.physics.arcade.overlap(ice.sprites, fires.sprites, iceExtinguishesFire, null, this);
    }
    resolver.resolve = resolve;
})(resolver || (resolver = {}));
module.exports = resolver;

},{"../fires/fire":3,"../ice/ice":5,"../player/player":9,"../world/tiles":12}],9:[function(require,module,exports){
"use strict";
var utilities = require("../utilities/utilities");
var constant = require("../utilities/constants");
var gravity = require("../physics/gravity");
var currentPosition = new Phaser.Point(0, 0);
var nextPosition = new Phaser.Point(0, 0);
function checkMovement(game) {
    if (gravity.checkCanSpriteStartFalling(player.sprite)) {
    }
    else if (game.input.keyboard.isDown(Phaser.Keyboard.LEFT)) {
        console.log("Moving left");
        utilities.getNextTileWorldCoordinates(-1, player.sprite, currentPosition, nextPosition);
    }
    else if (game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)) {
        console.log("Moving right");
        utilities.getNextTileWorldCoordinates(+1, player.sprite, currentPosition, nextPosition);
    }
}
;
var player;
(function (player) {
    player.sprite;
    function init(game) {
        var start = utilities.createFromType("START", "entities", utilities.lvlJson);
        if (start.length <= 0) {
            throw "Could not load START entity from given map. Please make sure you have a start defined";
        }
        var x = utilities.getTileFlooredXWorldCoordinate(start[0].x);
        var y = utilities.getTileFlooredYWorldCoordinate(start[0].y);
        player.sprite = game.add.sprite(x, y, "player");
        game.physics.enable(player.sprite, Phaser.Physics.ARCADE);
        player.sprite.frame = 5;
        player.sprite.body.collideWorldBounds = true;
        player.sprite.body.setSize(constant.TileSize.width, constant.TileSize.heigth);
        player.sprite.name = "player";
    }
    player.init = init;
    function checkInputs(game) {
        if ((player.sprite.body.velocity.x >= -constant.VelocityTreshold && player.sprite.body.velocity.x <= constant.VelocityTreshold) || (player.sprite.body.velocity.y <= constant.VelocityTreshold)) {
            checkMovement(game);
        }
    }
    player.checkInputs = checkInputs;
    ;
    function death() {
        player.sprite.kill();
    }
    player.death = death;
    function checkStopConditions(game) {
        var setPlayerToPosition = false;
        if (player.sprite.body.velocity.y > constant.VelocityTreshold) {
            console.log("(F) To position:", player.sprite.body.velocity.x, player.sprite.body.x, nextPosition.x);
        }
        if (player.sprite.body.velocity.x < -constant.VelocityTreshold && player.sprite.body.x <= nextPosition.x) {
            setPlayerToPosition = true;
            console.log("(L) To position:", player.sprite.body.velocity.x, player.sprite.body.x, nextPosition.x);
        }
        if (player.sprite.body.velocity.x > constant.VelocityTreshold && player.sprite.body.x >= nextPosition.x) {
            setPlayerToPosition = true;
            console.log("(R) To position:", player.sprite.body.velocity.x, player.sprite.body.x, nextPosition.x);
        }
        if (setPlayerToPosition) {
            if (!checkMovement(game)) {
                player.sprite.body.x = nextPosition.x;
                player.sprite.body.velocity.x = 0;
            }
        }
    }
    player.checkStopConditions = checkStopConditions;
})(player || (player = {}));
module.exports = player;

},{"../physics/gravity":7,"../utilities/constants":10,"../utilities/utilities":11}],10:[function(require,module,exports){
"use strict";
var constants;
(function (constants) {
    var levelsDirectory = "levels/";
    var imagesDirectory = "images/";
    constants.AssetDirectoryPath = "/assets/";
    constants.LevelsAssetDirectory = constants.AssetDirectoryPath + levelsDirectory;
    constants.ImagesAssetDirectory = constants.AssetDirectoryPath + imagesDirectory;
    constants.TileSize = { width: 32, heigth: 32 };
    constants.Velocity = 55;
    constants.VelocityTreshold = 0.1;
})(constants || (constants = {}));
;
module.exports = constants;

},{}],11:[function(require,module,exports){
var constant = require("./constants");
var utilities;
(function (utilities) {
    utilities.lvlJson = require("../../assets/levels/lvl.json");
    function getTileFlooredXWorldCoordinate(x) {
        return Math.floor(x / constant.TileSize.width) * constant.TileSize.width;
    }
    utilities.getTileFlooredXWorldCoordinate = getTileFlooredXWorldCoordinate;
    ;
    function getTileFlooredYWorldCoordinate(y) {
        return Math.floor(y / constant.TileSize.heigth) * constant.TileSize.heigth;
    }
    utilities.getTileFlooredYWorldCoordinate = getTileFlooredYWorldCoordinate;
    ;
    function getTileXFromWorldCoordinate(x) {
        return Math.floor(x / constant.TileSize.width);
    }
    utilities.getTileXFromWorldCoordinate = getTileXFromWorldCoordinate;
    ;
    function getTileYFromWorldCoordinate(y) {
        return Math.floor(y / constant.TileSize.heigth);
    }
    utilities.getTileYFromWorldCoordinate = getTileYFromWorldCoordinate;
    ;
    function getNextTileWorldCoordinates(velocityDirectionMultiplier, sprite, currentPosition, nextPosition) {
        var velocity = constant.Velocity * velocityDirectionMultiplier;
        currentPosition.x = sprite.body.x;
        nextPosition.x = utilities.getTileFlooredXWorldCoordinate(currentPosition.x + (constant.TileSize.width * velocityDirectionMultiplier));
        sprite.body.velocity.x = velocity;
        console.log("current.x/nextPosition.x", sprite.body.x, "/", nextPosition.x, ", nextPosition.y", nextPosition.y, ", velocity:", velocity);
    }
    utilities.getNextTileWorldCoordinates = getNextTileWorldCoordinates;
    ;
    function image(imageName) {
        return constant.ImagesAssetDirectory + imageName;
    }
    utilities.image = image;
    ;
    function level(levelName) {
        return constant.LevelsAssetDirectory + levelName;
    }
    utilities.level = level;
    ;
    function createSprite(element, group) {
        var sprite = group.create(element.x, element.y, element.properties.sprite);
        Object.keys(element.properties).forEach(function (key) {
            sprite[key] = element.properties[key];
        });
    }
    utilities.createSprite = createSprite;
    ;
    function createFromType(type, layer, tiledMapJson) {
        var results = [];
        tiledMapJson.layers.forEach(function (tmpLayer) {
            if (tmpLayer.name === layer) {
                tmpLayer.objects.forEach(function (object) {
                    if (object.type === type) {
                        object.y -= constant.TileSize.heigth;
                        results.push(object);
                    }
                });
            }
        });
        return results;
    }
    utilities.createFromType = createFromType;
    ;
    function fillSpriteGroup(spriteGroup, type, layer, frame, game) {
        createFromType(type, layer, utilities.lvlJson).forEach(function (obj) {
            var x = utilities.getTileFlooredXWorldCoordinate(obj.x);
            var y = utilities.getTileFlooredYWorldCoordinate(obj.y);
            var sprite = game.add.sprite(x, y, "items");
            game.physics.enable(sprite, Phaser.Physics.ARCADE);
            sprite.frame = frame;
            sprite.body.setSize(constant.TileSize.width, constant.TileSize.heigth);
            sprite.name = type;
            sprite.z = 1000;
            spriteGroup.add(sprite);
        });
    }
    utilities.fillSpriteGroup = fillSpriteGroup;
    ;
})(utilities || (utilities = {}));
;
module.exports = utilities;

},{"../../assets/levels/lvl.json":1,"./constants":10}],12:[function(require,module,exports){
"use strict";
var tiles;
(function (tiles) {
    tiles.map;
    tiles.layers = {};
    function loadLayers(layers) {
        if (!tiles.map) {
            throw "Map not created.";
        }
        layers.forEach(function (layer) {
            tiles.layers[layer] = tiles.map.createLayer(layer);
            tiles.layers[layer].resizeWorld();
        });
        tiles.map.setCollisionBetween(1, 2000, true, "collision");
    }
    tiles.loadLayers = loadLayers;
    ;
})(tiles || (tiles = {}));
module.exports = tiles;

},{}]},{},[2,6]);
